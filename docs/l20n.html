<!DOCTYPE html>  <html> <head>   <title>l20n.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="compiler.html">                 compiler.js               </a>                                           <a class="source" href="l20n-xml.html">                 l20n-xml.js               </a>                                           <a class="source" href="l20n.html">                 l20n.js               </a>                                           <a class="source" href="parser.html">                 parser.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               l20n.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="s1">&#39;use strict&#39;</span>
<span class="nx">let</span> <span class="nx">L20n</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">getContext</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">Context</span><span class="p">();</span>
  <span class="p">},</span>
  <span class="nx">_startLoading</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">let</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">overrideMimeType</span><span class="p">(</span><span class="s1">&#39;text/plain&#39;</span><span class="p">);</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;load&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">)</span>
    <span class="p">});</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="nx">res</span><span class="p">.</span><span class="nx">uri</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">L20n</span><span class="p">.</span><span class="nx">Resource</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">aURI</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">uri</span> <span class="o">=</span> <span class="nx">aURI</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">L20n</span><span class="p">.</span><span class="nx">Resource</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">_loading</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">_ast</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nx">uri</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
<span class="p">}</span>

<span class="nx">L20n</span><span class="p">.</span><span class="nx">Context</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">let</span> <span class="nx">mFrozen</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nx">let</span> <span class="nx">mCompiled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nx">let</span> <span class="nx">mPreprocessed</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nx">let</span> <span class="nx">mResources</span> <span class="o">=</span> <span class="p">{};</span> <span class="c1">// resource files</span>
  <span class="nx">let</span> <span class="nx">mEvents</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ready&#39;</span><span class="o">:</span> <span class="p">[]}</span>
  <span class="nx">let</span> <span class="nx">mParser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">L20n</span><span class="p">.</span><span class="nx">Parser</span><span class="p">();</span>

  <span class="nx">let</span> <span class="nx">mObjects</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;ast&#39;</span><span class="o">:</span> <span class="p">[],</span>
    <span class="s1">&#39;entries&#39;</span><span class="o">:</span> <span class="p">{},</span> <span class="c1">// resource entries</span>
    <span class="s1">&#39;ctxdata&#39;</span><span class="o">:</span> <span class="p">{},</span> <span class="c1">// context variables</span>
    <span class="s1">&#39;globals&#39;</span><span class="o">:</span> <span class="p">{},</span> <span class="c1">// global variables</span>
  <span class="p">}</span>

  <span class="nx">mObjects</span><span class="p">[</span><span class="s1">&#39;globals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">get</span> <span class="nx">hour</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getHours</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">get</span> <span class="nx">os</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="sr">/^MacIntel/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">platform</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;mac&#39;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="sr">/^Linux/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">platform</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;linux&#39;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="sr">/^Win/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">navigatgor</span><span class="p">.</span><span class="nx">platform</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;win&#39;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="s1">&#39;unknown&#39;</span>
    <span class="p">},</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">addResource</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">aURI</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">let</span> <span class="nx">res</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getObject</span><span class="p">(</span><span class="nx">aURI</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">mObjects</span><span class="p">[</span><span class="s1">&#39;ast&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">mObjects</span><span class="p">[</span><span class="s1">&#39;ast&#39;</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">body</span><span class="p">)</span>
      <span class="p">});</span>
    <span class="p">},</span>
    <span class="nx">__preprocessAST</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">let</span> <span class="nx">self</span><span class="o">=</span><span class="k">this</span><span class="p">;</span>
      <span class="nx">ast</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">pos</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s1">&#39;ImportStatement&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">self</span><span class="p">.</span><span class="nx">_getObject</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">uri</span><span class="p">.</span><span class="nx">content</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">subAST</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ast</span><span class="p">.</span><span class="nx">splice</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span> <span class="p">[</span><span class="nx">pos</span><span class="p">,</span> <span class="mi">1</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">subAST</span><span class="p">.</span><span class="nx">body</span><span class="p">))</span>
          <span class="p">})</span>
        <span class="p">}</span>
      <span class="p">})</span>
      <span class="nx">mPreprocessed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isReady</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">onASTReady</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">_getArgs</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">let</span> <span class="nx">args</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">mObjects</span><span class="p">[</span><span class="s1">&#39;ctxdata&#39;</span><span class="p">])</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">let</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">args</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">args</span>
    <span class="p">},</span>
    <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">mCompiled</span><span class="p">)</span>
        <span class="k">throw</span> <span class="s2">&quot;Error&quot;</span>
      <span class="nx">let</span> <span class="nx">entity</span> <span class="o">=</span> <span class="nx">mObjects</span><span class="p">[</span><span class="s1">&#39;entries&#39;</span><span class="p">][</span><span class="nx">id</span><span class="p">]</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">entity</span> <span class="o">||</span> <span class="nx">entity</span><span class="p">.</span><span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s2">&quot;No such entity: &quot;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">null</span>
      <span class="p">}</span>
      <span class="nx">let</span> <span class="nx">args</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getArgs</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">entity</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="nx">getAttribute</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">attr</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">mCompiled</span><span class="p">)</span>
        <span class="k">throw</span> <span class="s2">&quot;Error&quot;</span>
      <span class="nx">let</span> <span class="nx">entity</span> <span class="o">=</span> <span class="nx">mObjects</span><span class="p">[</span><span class="s1">&#39;entries&#39;</span><span class="p">][</span><span class="nx">id</span><span class="p">]</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">entity</span> <span class="o">||</span> <span class="nx">entity</span><span class="p">.</span><span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s2">&quot;No such entity: &quot;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">null</span>
      <span class="p">}</span>
      <span class="nx">let</span> <span class="nx">attribute</span> <span class="o">=</span> <span class="nx">entity</span><span class="p">.</span><span class="nx">attributes</span><span class="p">[</span><span class="nx">attr</span><span class="p">]</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">attribute</span> <span class="o">||</span> <span class="nx">attribute</span><span class="p">.</span><span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s2">&quot;No such attribute: &quot;</span> <span class="o">+</span> <span class="nx">attr</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">null</span>
      <span class="p">}</span>
      <span class="nx">let</span> <span class="nx">args</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getArgs</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">attribute</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="nx">getAttributes</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">mCompiled</span><span class="p">)</span>
        <span class="k">throw</span> <span class="s2">&quot;Error&quot;</span>
      <span class="nx">let</span> <span class="nx">entity</span> <span class="o">=</span> <span class="nx">mObjects</span><span class="p">[</span><span class="s1">&#39;entries&#39;</span><span class="p">][</span><span class="nx">id</span><span class="p">]</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">entity</span> <span class="o">||</span> <span class="nx">entity</span><span class="p">.</span><span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s2">&quot;No such entity: &quot;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">null</span>
      <span class="p">}</span>
      <span class="nx">let</span> <span class="nx">args</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getArgs</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
      <span class="nx">let</span> <span class="nx">attributes</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">let</span> <span class="nx">attr</span> <span class="k">in</span> <span class="nx">entity</span><span class="p">.</span><span class="nx">attributes</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">let</span> <span class="nx">attribute</span> <span class="o">=</span> <span class="nx">entity</span><span class="p">.</span><span class="nx">attributes</span><span class="p">[</span><span class="nx">attr</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">attribute</span><span class="p">.</span><span class="nx">local</span><span class="p">)</span>
          <span class="nx">attributes</span><span class="p">[</span><span class="nx">attr</span><span class="p">]</span> <span class="o">=</span> <span class="nx">attribute</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">attributes</span>
    <span class="p">},</span>
    <span class="nx">getEntity</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">},</span>
    <span class="nx">isFrozen</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">mFrozen</span><span class="p">;</span> 
    <span class="p">},</span>
    <span class="nx">isCompiled</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">mCompiled</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">isReady</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">mFrozen</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">let</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">mResources</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">mResources</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">_loading</span><span class="p">)</span>
          <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">onASTReady</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">mCompiled</span><span class="p">)</span>
        <span class="k">return</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">mPreprocessed</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">__preprocessAST</span><span class="p">(</span><span class="nx">mObjects</span><span class="p">[</span><span class="s1">&#39;ast&#39;</span><span class="p">]);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">L20n</span><span class="p">.</span><span class="nx">Compiler</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="nx">mObjects</span><span class="p">[</span><span class="s1">&#39;ast&#39;</span><span class="p">],</span>
                              <span class="nx">mObjects</span><span class="p">[</span><span class="s1">&#39;entries&#39;</span><span class="p">],</span>
                              <span class="nx">mObjects</span><span class="p">[</span><span class="s1">&#39;globals&#39;</span><span class="p">]);</span>
        <span class="nx">mCompiled</span> <span class="o">=</span> <span class="kc">true</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_fireCallbacks</span><span class="p">();</span> 
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">getAST</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;res&#39;</span><span class="o">:</span> <span class="nx">mResources</span><span class="p">,</span> <span class="s1">&#39;obj&#39;</span><span class="o">:</span> <span class="nx">mObjects</span><span class="p">};</span>
    <span class="p">},</span>
    <span class="nx">set</span> <span class="nx">onReady</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">mFrozen</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">mEvents</span><span class="p">[</span><span class="s1">&#39;ready&#39;</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isReady</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">onASTReady</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">set</span> <span class="nx">data</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">mObjects</span><span class="p">[</span><span class="s1">&#39;ctxdata&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">data</span>
    <span class="p">},</span>
    <span class="nx">get</span> <span class="nx">data</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">mObjects</span><span class="p">[</span><span class="s1">&#39;ctxdata&#39;</span><span class="p">];</span>
    <span class="p">},</span>
    <span class="nx">_getObject</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">let</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="nx">let</span> <span class="nx">res</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">L20n</span><span class="p">.</span><span class="nx">Resource</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
      <span class="nx">let</span> <span class="nx">_injectResource</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">let</span> <span class="nx">ast</span> <span class="o">=</span> <span class="nx">mParser</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">_ast</span> <span class="o">=</span> <span class="nx">ast</span><span class="p">;</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">_loading</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="nx">callback</span><span class="p">(</span><span class="nx">ast</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">isReady</span><span class="p">())</span> <span class="p">{</span>
          <span class="nx">self</span><span class="p">.</span><span class="nx">onASTReady</span><span class="p">();</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="nx">L20n</span><span class="p">.</span><span class="nx">_startLoading</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">_injectResource</span><span class="p">);</span>
      <span class="nx">mResources</span><span class="p">[</span><span class="nx">url</span><span class="p">]</span> <span class="o">=</span> <span class="nx">res</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">_fireCallbacks</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">mEvents</span><span class="p">[</span><span class="s1">&#39;ready&#39;</span><span class="p">].</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">let</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">mEvents</span><span class="p">[</span><span class="s1">&#39;ready&#39;</span><span class="p">])</span>
          <span class="nx">mEvents</span><span class="p">[</span><span class="s1">&#39;ready&#39;</span><span class="p">][</span><span class="nx">i</span><span class="p">](</span><span class="k">this</span><span class="p">);</span>
        <span class="nx">mEvents</span><span class="p">[</span><span class="s1">&#39;ready&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 